<template id="contact-template">
	<style scoped>
		:host(hd-contact){
			text-align: center;
			display:	block;
			width:	100%;
			min-height:	400px;
			padding-bottom:	40px;
			background-color:	rgb(253, 200, 21);
			font-family:	bebas, sans-serif;
			font-size:		150%;
			color:	white;
			padding-top:	32px;
		}
		:host(hd-contact) hr {
			width:					100px;
			color:					lightgray;
		}
		:host(hd-contact) ::content #messAlert{
			position: absolute;
			top: 0;
			left: 0;
			width:	100%;
			height: 400px;
			padding-top:	275px;
			background-color: rgb(253, 200, 21);
			color: #3D3C37;
			text-align: center;
		}
		::content .hd-contact-input {
			text-align: right;
		}
		::content textarea {
			width:	400px;
			height: 100px;
			resize:	none;
		}
		::content #divButtonRequest {
			text-align: center;
			margin-top:	10px;
		}
		::content #divButtonFinal {
			text-align: center;
			margin-top:	10px;
		}
		::content .hd-contact-input {
			text-align: right;
		}
		::content .hd-step {
			margin-top:	20px;
		}
		::content .hd-contact-allInput {
			margin-bottom:		10px;
			border: 			0;
			outline: 			0;
			background: 		transparent;
			border-bottom: 		2px solid rgb(253, 200, 21);
			text-align:			right;
		}
		::content label {
			margin-bottom:		10px;
		}
		::content button {
			font-family:	bebas, sans-serif;
			font-size:	90%;
			border-radius:	10px;
		}
		::content #errorDiv {
			margin-top: 20px;
			text-align: center;
		}
		hd-contact{
			text-align: center;
			display:	block;
			width:	100%;
			min-height:	400px;
			padding-bottom:	40px;
			background-color:	rgb(253, 200, 21);
			font-family:	bebas, sans-serif;
			font-size:		150%;
			color:	white;
		}
		hd-contact > hr {
			width:					100px;
			color:					lightgray;
		}
		hd-contact #messAlert{
			position: absolute;
			top: 0;
			left: 0;
			width:	100%;
			height: 400px;
			padding-top:	275px;
			background-color: rgb(253, 200, 21);
			color: #3D3C37;
			text-align: center;
		}
		#contact-title {
			position: 		absolute;
			top:			20px;
			left:			20px;
		}
		#contact-infos{
			width:			100%;
			position:		absolute;
			left:			0;
			bottom:			20px;
		}
		#hd-form {
			background-color:		white;
			margin:					auto;
			color:					black;
			width:					400px;
			padding:				20px 10px 10px 20px;
			text-align:				left;
			margin-bottom:			60px;
		}
		.hd-contact-input {
			text-align: right;
		}
		.hd-step textarea {
			width:	400px;
			height: 100px;
			resize:	none;
		}
		.hd-step #divButtonRequest {
			text-align: center;
			margin-top:	10px;
		}
		.hd-step #divButtonFinal {
			text-align: center;
			margin-top:	10px;
		}
		.hd-step .hd-contact-input {
			text-align: right;
		}
		.hd-step .hd-contact-allInput {
			margin-bottom:		10px;
			border: 			0;
			outline: 			0;
			background: 		transparent;
			border-bottom: 		2px solid rgb(253, 200, 21);
			text-align:			right;
		}
		.hd-step label {
			margin-bottom:		10px;
		}
		.hd-step button {
			font-family:	bebas, sans-serif;
			font-size:	90%;
			border-radius:	10px;
		}
		#errorDiv {
			margin-top: 20px;
			text-align: center;
		}
	</style>
			<div id="contact-title">HAPPY DEV</div>
			<div id="contact-infos">Retrouvez nous à mutinerie</div>
			<form id="hd-form">
				<hr align="left"/>
				<content></content>
			</form>
</template>
	
<script>
	(function(){
		var localDoc = document._currentScript.ownerDocument;
		
		var ContactPrototype = Object.create(HTMLElement.prototype, {
            createdCallback: {
                value: function() {
					this.data();
                    var clone = document.importNode(localDoc.querySelector('#contact-template').content, true);
                    this.createShadowRoot().appendChild(clone);
                }
            }
        });
		
		ContactPrototype.data = function data(){
			var container = document.createElement("div");
			var contactBr = document.createElement("br");
			var label = document.createElement("label");
			label.setAttribute("for","hd-contact-name");
			label.appendChild(document.createTextNode("> Bonjour ! Comment t'appelles tu ?"));
			var inputDiv = document.createElement("div");
			inputDiv.className = "hd-contact-input";
			var input = document.createElement("input");
			input.setAttribute("type","text");
			input.setAttribute("name","hd-name");
			input.setAttribute("id","hd-contact-name");
			input.setAttribute("placeholder","PRENOM");
			input.className = "hd-contact-allInput";
			input.addEventListener("change",function(){
				this.step2();
			}.bind(this));
			inputDiv.appendChild(input);
			inputDiv.appendChild(document.createTextNode("<"));
			container.appendChild(label);
			container.appendChild(contactBr);
			container.appendChild(inputDiv);
			this.appendChild(container);
		}
		
		ContactPrototype.step2 = function step2(){
			if(!this.querySelector("#hd-contact-howru")){
				var container = document.createElement("div");
				container.setAttribute("id","hd-contactStep1");
				container.className = "hd-step";
				var contactBr = document.createElement("br");
				var label = document.createElement("label");
				label.setAttribute("for","hd-contact-howru");
				label.appendChild(document.createTextNode("> Enchanté "+this.querySelector("#hd-contact-name").value+"! Comment ça va aujourd'hui?"));
				var inputDiv = document.createElement("div");
				inputDiv.className = "hd-contact-input";
				var input = document.createElement("input");
				input.setAttribute("type","text");
				input.setAttribute("name","hd-howru");
				input.setAttribute("id","hd-contact-howru");
				input.className = "hd-contact-allInput";
				input.addEventListener("change",function(){
					this.step3();
				}.bind(this));
				inputDiv.appendChild(input);
				inputDiv.appendChild(document.createTextNode("<"));
				container.appendChild(label);
				container.appendChild(contactBr);
				container.appendChild(inputDiv);
				this.appendChild(container);
				
				this.querySelector("#hd-contact-howru").focus();
			}else{
				var contactName = this.querySelector("#hd-contact-name").value;
				var step2 = this.querySelector("#hd-contactStep1 label");
				step2.innerHTML = "> Enchanté "+contactName+"! Comment ça va aujourd'hui?";
			}
		}
		
		ContactPrototype.step3 = function step3(){
			if(!this.querySelector("#hd-contact-request")){
				var container = document.createElement("div");
				container.className = "hd-step";
				var contactBr = document.createElement("br");
				var label = document.createElement("label");
				label.setAttribute("for","hd-contact-request");
				label.appendChild(document.createTextNode("> Qu'est-ce qu'on peut faire pour toi?"));
				var textarea = document.createElement("textarea");
				textarea.setAttribute("name","hd-request");
				textarea.setAttribute("id","hd-contact-request");
				textarea.setAttribute("placeholder","Votre requête.");
				var divButton = document.createElement("div");
				divButton.setAttribute("id","divButtonRequest");
				var step3Button = document.createElement("button");
				step3Button.setAttribute("id","hd-contact-button");
				step3Button.appendChild(document.createTextNode("Valider"));
				step3Button.addEventListener("click",function(){
					this.step4();
					this.querySelector("#divButtonRequest").remove();
				}.bind(this));
				divButton.appendChild(step3Button);
				container.appendChild(label);
				container.appendChild(contactBr);
				container.appendChild(textarea);
				container.appendChild(divButton);
				this.appendChild(container);
				this.querySelector("#hd-contact-request").focus();
			}
		}
		
		ContactPrototype.step4 = function step4(){
			if(!this.querySelector("#hd-contact-contact")){
				var container = document.createElement("div");
				container.className = "hd-step";
				var contactBr = document.createElement("br");
				var label = document.createElement("label");
				label.setAttribute("for","hd-contact-contact");
				label.appendChild(document.createTextNode("> Comment peut-on te joindre?"));
				var inputDiv = document.createElement("div");
				inputDiv.className = "hd-contact-input";
				var input = document.createElement("input");
				input.setAttribute("type","text");
				input.setAttribute("name","hd-contact");
				input.setAttribute("id","hd-contact-contact");
				input.className = "hd-contact-allInput";
				var divButton = document.createElement("div");
				divButton.setAttribute("id","divButtonFinal");
				var step4Button = document.createElement("button");
				step4Button.setAttribute("id","hd-contact-validationButton");
				step4Button.appendChild(document.createTextNode("Valider"));
				step4Button.addEventListener("click",function(){
					this.mailSend();
				}.bind(this));
				divButton.appendChild(step4Button);
				inputDiv.appendChild(input);
				inputDiv.appendChild(document.createTextNode("<"));
				container.appendChild(label);
				container.appendChild(contactBr);
				container.appendChild(inputDiv);
				container.appendChild(divButton);
				this.appendChild(container);
				this.querySelector("#hd-contact-contact").focus();
			}
		}
		
		ContactPrototype.mailSend = function mailSend(){
			if(this.querySelector("#errorDiv")) this.querySelector("#errorDiv").remove();
		
			var xhttp = new XMLHttpRequest();
			var params = "name="+this.querySelector("#hd-contact-name").value+"&howru="+this.querySelector("#hd-contact-howru").value+"&request="+this.querySelector("#hd-contact-request").value+"&contact="+this.querySelector("#hd-contact-contact").value+"&action="+this.dataset.action+"&mails="+this.dataset.mails;
			xhttp.open("POST",this.dataset.target, true);
			
			xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			
			xhttp.onreadystatechange = function(){
				if(xhttp.readyState == 4 && xhttp.status == 200){
					var messAlert = document.createElement("div");
					messAlert.setAttribute("id","messAlert");
					messAlert.appendChild(document.createTextNode("Merci pour ton message, on va le prendre en compte dans les meilleurs délais!"));
					
					this.appendChild(messAlert);
					var objectCP = this;
					setTimeout(function() {
						event = new MouseEvent("click");
						objectCP.parentNode.querySelector("img").dispatchEvent(event);},3000);
				}else{
					var errorDiv = document.createElement("div");
					errorDiv.setAttribute("id","errorDiv");
					errorDiv.appendChild(document.createTextNode("Une erreur s'est produite, merci de réessayer plus tard."));
					errorDiv.appendChild(document.createElement("br"));
					errorDiv.appendChild(document.createTextNode("Veuillez nous excusez pour la gène occasioné."));
					this.appendChild(errorDiv);
				}
			}.bind(this);
			
			xhttp.send(params);
		}
		
		document.registerElement("hd-contact",{prototype: ContactPrototype});
	})();
</script>